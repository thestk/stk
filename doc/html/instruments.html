<HTML>
<HEAD>
<TITLE>The Synthesis ToolKit in C++ (STK)</TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<CENTER>
<img src="princeton.gif"> &nbsp; <img src="ccrma.gif"> &nbsp; <img src="mcgill.gif"><P>
<a class="qindex" href="index.html">Home</a> &nbsp; <a class="qindex" href="information.html">Information</a> &nbsp; <a class="qindex" href="classes.html">Classes</a> &nbsp; <a class="qindex" href="download.html">Download</a> &nbsp; <a class="qindex" href="usage.html">Usage</a> &nbsp; <a class="qindex" href="maillist.html">Mail List</a> &nbsp; <a class="qindex" href="system.html">Requirements</a> &nbsp; <a class="qindex" href="links.html">Links</a> &nbsp; <a class="qindex" href="tutorial.html">Tutorial</a></CENTER>
<HR>
<!-- Generated by Doxygen 1.4.4 -->
<h1><a class="anchor" name="instruments">Instruments</a></h1>The ToolKit comes with a wide variety of synthesis algorithms, all of which inherit from the <a class="el" href="classInstrmnt.html">Instrmnt</a> class. In this example, we'll fire up an instance of the <a class="el" href="classBeeThree.html">BeeThree</a> <a class="el" href="classFM.html">FM</a> synthesis class and show how its frequency can be modified over time.<p>
<div class="fragment"><pre class="fragment"><span class="comment">// bethree.cpp STK tutorial program</span>

<span class="preprocessor">#include "BeeThree.h"</span>
<span class="preprocessor">#include "RtAudio.h"</span>

<span class="comment">// The TickData structure holds all the class instances and data that</span>
<span class="comment">// are shared by the various processing functions.</span>
<span class="keyword">struct </span>TickData {
  <a class="code" href="classInstrmnt.html">Instrmnt</a> *instrument;
  StkFloat frequency;
  StkFloat scaler;
  <span class="keywordtype">long</span> counter;
  <span class="keywordtype">bool</span> done;

  <span class="comment">// Default constructor.</span>
  TickData()
    : instrument(0), scaler(1.0), counter(0), done( false ) {}
};

<span class="comment">// This tick() function handles sample computation only.  It will be</span>
<span class="comment">// called automatically when the system needs a new buffer of audio</span>
<span class="comment">// samples.</span>
<span class="keywordtype">int</span> tick(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">int</span> bufferSize, <span class="keywordtype">void</span> *dataPointer)
{
  TickData *data = (TickData *) dataPointer;
  <span class="keyword">register</span> StkFloat *samples = (StkFloat *) buffer;

  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;bufferSize; i++ ) {
    *samples++ = data-&gt;instrument-&gt;tick();
    <span class="keywordflow">if</span> ( ++data-&gt;counter % 2000 == 0 ) {
      data-&gt;scaler += 0.025;
      data-&gt;instrument-&gt;setFrequency( data-&gt;frequency * data-&gt;scaler );
    }
  }

  <span class="keywordflow">if</span> ( data-&gt;counter &gt; 80000 )
    data-&gt;done = <span class="keyword">true</span>;

  <span class="keywordflow">return</span> 0;
}

<span class="keywordtype">int</span> main()
{
  <span class="comment">// Set the global sample rate and rawwave path before creating class instances.</span>
  <a class="code" href="classStk.html#e1">Stk::setSampleRate</a>( 44100.0 );
  <a class="code" href="classStk.html#e3">Stk::setRawwavePath</a>( <span class="stringliteral">"../../rawwaves/"</span> );

  TickData data;
  <a class="code" href="classRtAudio.html">RtAudio</a> *dac = 0;

  <span class="comment">// Figure out how many bytes in an StkFloat and setup the RtAudio object.</span>
  RtAudioFormat format = ( <span class="keyword">sizeof</span>(StkFloat) == 8 ) ? RTAUDIO_FLOAT64 : RTAUDIO_FLOAT32;
  <span class="keywordtype">int</span> bufferSize = RT_BUFFER_SIZE;
  <span class="keywordflow">try</span> {
    dac = <span class="keyword">new</span> <a class="code" href="classRtAudio.html">RtAudio</a>(0, 1, 0, 0, format, (<span class="keywordtype">int</span>)<a class="code" href="classStk.html#e0">Stk::sampleRate</a>(), &amp;bufferSize, 4);
  }
  <span class="keywordflow">catch</span> (<a class="code" href="classRtError.html">RtError</a>&amp; error) {
    error.<a class="code" href="classRtError.html#a2">printMessage</a>();
    <span class="keywordflow">goto</span> cleanup;
  }

  <span class="keywordflow">try</span> {
    <span class="comment">// Define and load the BeeThree instrument</span>
    data.instrument = <span class="keyword">new</span> <a class="code" href="classBeeThree.html">BeeThree</a>();
  }
  <span class="keywordflow">catch</span> (<a class="code" href="classStkError.html">StkError</a> &amp;) {
    <span class="keywordflow">goto</span> cleanup;
  }

  data.frequency = 220.0;
  data.instrument-&gt;noteOn( data.frequency, 0.5 );

  <span class="keywordflow">try</span> {
    dac-&gt;<a class="code" href="classRtAudio.html#a6">setStreamCallback</a>(&amp;tick, (<span class="keywordtype">void</span> *)&amp;data);
    dac-&gt;<a class="code" href="classRtAudio.html#a13">startStream</a>();
  }
  <span class="keywordflow">catch</span> (<a class="code" href="classRtError.html">RtError</a> &amp;error) {
    error.<a class="code" href="classRtError.html#a2">printMessage</a>();
    <span class="keywordflow">goto</span> cleanup;
  }

  <span class="comment">// Block waiting until callback signals done.</span>
  <span class="keywordflow">while</span> ( !data.done )
    <a class="code" href="classStk.html#e7">Stk::sleep</a>( 100 );
  
  <span class="comment">// Shut down the callback and output stream.</span>
  <span class="keywordflow">try</span> {
    dac-&gt;<a class="code" href="classRtAudio.html#a7">cancelStreamCallback</a>();
    dac-&gt;<a class="code" href="classRtAudio.html#a12">closeStream</a>();
  }
  <span class="keywordflow">catch</span> (<a class="code" href="classRtError.html">RtError</a> &amp;error) {
    error.<a class="code" href="classRtError.html#a2">printMessage</a>();
  }

 cleanup:
  <span class="keyword">delete</span> data.instrument;
  <span class="keyword">delete</span> dac;

  <span class="keywordflow">return</span> 0;
}
</pre></div><p>
We have used an <a class="el" href="classInstrmnt.html">Instrmnt</a> pointer when referencing the <a class="el" href="classBeeThree.html">BeeThree</a> instance above, so it would be simple to replace the <a class="el" href="classBeeThree.html">BeeThree</a> class with any other STK instrument class. It should be noted, however, that a few classes do not respond to the setFrequency() function (e.g., <a class="el" href="classShakers.html">Shakers</a>, <a class="el" href="classDrummer.html">Drummer</a>).<p>
The noteOn() function initiates an instrument attack. Instruments that are continuously excited (e.g., <a class="el" href="classClarinet.html">Clarinet</a>, <a class="el" href="classBeeThree.html">BeeThree</a>) will continue to sound until stopped with a noteOff(). Impulsively excited instrument sounds (e.g., <a class="el" href="classPlucked.html">Plucked</a>, <a class="el" href="classWurley.html">Wurley</a>) typically decay within a few seconds time, requiring subsequent noteOn() messages for re-attack.<p>
Instrument parameters can be precisely controlled as demonstrated above. A more flexible approach to instrument control, allowing arbitrary scorefile or realtime updates, is described in the next tutorial chapter.<p>
[<a href="tutorial.html">Main tutorial page</a>] &nbsp; [<a href="controlin.html">Next tutorial</a>] <HR>

<table>
  <tr><td><A HREF="http://ccrma.stanford.edu/software/stk/"><I>The Synthesis ToolKit in C++ (STK)</I></A></td></tr>
  <tr><td>&copy;1995-2005 Perry R. Cook and Gary P. Scavone. All Rights Reserved.</td></tr>
</table>

</BODY>
</HTML>
